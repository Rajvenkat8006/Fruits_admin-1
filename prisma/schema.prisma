generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum OrderStatus {
  PENDING
  PAID
  FULFILLED
  CANCELLED
  REFUNDED
  PROCESSING
  DELIVERED
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CARD
  UPI
  NETBANKING
  WALLET
  COD
  CASH_ON_DELIVERY
}

enum DiscountType {
  PERCENTAGE
  AMOUNT
}

model Category {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  slug      String    @unique
  icon      String?
  products  Product[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("categories")
}

model Product {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  slug        String      @unique
  description String?
  price       Float
  image       String?
  stock       Int         @default(0)
  featured    Boolean     @default(false)

  categoryId  String      @db.ObjectId
  category    Category?    @relation(fields: [categoryId], references: [id])

  cartItems   Cart[]
  watchlists  Watchlist[]
  orderItems  OrderItem[]
  reviews     Review[]

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([name])
  @@map("products")
}

model User {
  id         String        @id @default(auto()) @map("_id") @db.ObjectId
  name       String?
  email      String?       @unique
  password   String
  profilePic String?
  cart       Cart[]
  watchlist  Watchlist[]
  orders     Order[]
  reviews    Review[]
  reviewLikes ReviewLike[]

  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  @@map("users")
}

model Review {
  id        String        @id @default(auto()) @map("_id") @db.ObjectId
  rating    Int
  comment   String?

  userId    String        @db.ObjectId
  productId String        @db.ObjectId

  user      User          @relation(fields: [userId], references: [id])
  product   Product       @relation(fields: [productId], references: [id])
  likes     ReviewLike[]

  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@unique([userId, productId])
  @@index([productId])
  @@map("reviews")
}

model ReviewLike {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId

  userId    String   @db.ObjectId
  reviewId  String   @db.ObjectId

  user      User     @relation(fields: [userId], references: [id])
  review    Review   @relation(fields: [reviewId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, reviewId])
  @@index([reviewId])
  @@map("review_likes")
}

model Cart {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  userId    String    @db.ObjectId
  productId String    @db.ObjectId
  quantity  Int       @default(1)

  user      User      @relation(fields: [userId], references: [id])
  product   Product   @relation(fields: [productId], references: [id])

  addedAt   DateTime  @default(now())

  @@unique([userId, productId])
  @@map("carts")
}

model Watchlist {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  userId    String    @db.ObjectId
  productId String    @db.ObjectId

  user      User      @relation(fields: [userId], references: [id])
  product   Product   @relation(fields: [productId], references: [id])

  addedAt   DateTime  @default(now())

  @@unique([userId, productId])
  @@map("watchlists")
}

model Order {
  id              String           @id @default(auto()) @map("_id") @db.ObjectId
  userId          String           @db.ObjectId
  couponId        String?          @db.ObjectId
  total           Float
  status          OrderStatus      @default(PENDING)

  items           OrderItem[]
  payments        Payment[]
  shippingAddress ShippingAddress[]
  user            User?            @relation(fields: [userId], references: [id])
  coupon          Coupon?          @relation(fields: [couponId], references: [id])

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([status])
  @@map("orders")
}

model OrderItem {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  orderId   String    @db.ObjectId
  productId String    @db.ObjectId
  price     Float
  quantity  Int       @default(1)

  product   Product?   @relation(fields: [productId], references: [id])
  order     Order     @relation(fields: [orderId], references: [id])

  @@map("order_items")
}

model Banner {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  title     String?
  image     String
  link      String?

  position  Int      @default(0)
  isActive  Boolean  @default(true)

  startDate DateTime?
  endDate   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
  @@index([position])
  @@map("banners")
}

model Payment {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  orderId       String         @db.ObjectId

  paymentId     String?
  method        PaymentMethod
  amount        Float
  status        PaymentStatus  @default(PENDING)
  gateway       String         // Stripe, Razorpay, PayPal
  transactionId String?

  order         Order          @relation(fields: [orderId], references: [id])

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  @@index([orderId])
  @@map("payments")
}


model ShippingAddress {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId   String   @db.ObjectId

  name      String
  street    String
  city      String
  state     String
  zip       String
  country   String
  phone     String

  order     Order    @relation(fields: [orderId], references: [id])

  createdAt DateTime @default(now())

  @@map("shipping_addresses")
}


model Coupon {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  code          String        @unique
  discountType  DiscountType
  value         Float
  expiryDate    DateTime?
  usageLimit    Int?
  usedCount     Int           @default(0)
  isActive      Boolean       @default(true)

  orders        Order[]

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@map("coupons")
}
